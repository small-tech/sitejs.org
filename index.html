<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site.js</title>
  <!-- Start: styles -->
  <link rel='stylesheet' href='css/perfect-scrollbar.css'>
  <link rel='stylesheet' href='css/facade.css'>
  <link rel='stylesheet' href='css/prism.css'>
  <link rel='stylesheet' href='css/index.css'>
  <!-- End: styles -->
</head>
<body>
  <header>
    <div class='content'>
      <!-- Title -->
      <h1><strong>Site</strong>.js</h1>

      <!-- Navigation -->
      <nav>
        <ul>
          <li class='selected'>Home</li>
          <li><a href='https://source.ind.ie/site.js/app/blob/master/CHANGELOG.md'>News</a></li>
          <li><a href='https://small-tech.org/fund-us'>Fund Us!</a></li>
        </ul>
      </nav>

      <!-- Browser presentation -->
      <div id='browser' class='shadow' aria-hidden='true'></div>

      <!-- Terminal presentation -->
      <div id='presentation' aria-hidden='true'>
        <div id='terminal-presentation' class='unfocused shadow'></div>
        <div id='second-terminal-presentation' class='shadow'></div>
        <button id='next-button' class='next-button' disabled>Next</button>
      </div>

      <!-- Short description -->
      <p id='summary'><strong>Develop, test, and deploy</strong> your <strong>secure static</strong> or <strong>dynamic personal</strong> web site with <strong>zero configuration.</strong></p>
    </div>
  </header>

  <main>
    <div class='content'>
      <h2 id="install">Install</h2>

      <p>Copy and paste the following command into your Terminal. <strong>Before you pipe any script into your computer, always <span id='view-installation-script-source'>view the source code (<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install">Linux and macOS</a>, <a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/windows">Windows</a>)</span> and make sure you understand what it does.</strong></p>

      <section id='install-linux' class='installation-instructions'>
        <h3>Linux</h3>

        <pre><code id='code-linux'>wget -qO- <span class='token string'>https://sitejs.org/install</span> <span class='token keyword'>| bash</span></code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("linux")'>Copy</button></pre>
      </section>

      <section id='install-mac' class='installation-instructions'>
        <h3>macOS</h3>

        <pre><code id='code-mac'>curl -s <span class='token string'>https://sitejs.org/install</span> <span class='token keyword'>| bash</span></code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("mac")'>Copy</button></pre>
      </section>

      <section id='install-windows' class='installation-instructions'>
        <h3>Windows 10 (PowerShell on Windows Terminal)</h3>

        <pre><code id='code-windows'>iex(iwr -UseBasicParsing <span class='token string'>https://sitejs.org/windows</span>).Content</code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("windows")'>Copy</button></pre>
      </section>

      <p id='links-to-instructions-for-other-platforms' hidden>
        <strong>Instructions for other platforms:</strong>
        <span id='link-linux'><a onClick='displayInstallationInstructionsFor("linux")'>Linux</a> | </span>
        <span id='link-mac'><a onClick='displayInstallationInstructionsFor("mac")'>macOS</a><span id='pipe-before-windows'> | </span></span>
        <a id='link-windows' onClick='displayInstallationInstructionsFor("windows")'>Windows</a>
      </p>

      <script>
        // Progressively enhance the installation instructions to only show the ones for the
        // detected platform (with links to the others), if we can detect a supported platform.
        const userAgent = navigator.userAgent.toLowerCase()
        let currentPlatform = 'unknown'
        if (userAgent.includes('linux')) { currentPlatform = 'linux' }
        if (userAgent.includes('mac os x')) { currentPlatform = 'mac' }
        if (userAgent.includes('windows')) { currentPlatform = 'windows'}

        displayInstallationInstructionsFor(currentPlatform)

        function displayInstallationInstructionsFor(currentPlatform) {
          if (currentPlatform !== 'unknown') {
            // Show the instructions for the detected platform and hide the ones for the other platforms.
            ['linux', 'mac', 'windows'].forEach(platform => {
              document.querySelector(`#install-${platform}`).hidden = !(platform === currentPlatform)
              document.querySelector(`#link-${platform}`).hidden = (platform === currentPlatform)
            })

            // Cosmetic: don’t show the last separator if there’s no content after it.
            document.querySelector('#pipe-before-windows').hidden = (currentPlatform === 'windows')

            // Show links to instructions for other platforms.
            document.querySelector('#links-to-instructions-for-other-platforms').hidden = false

            // Show all the copy to clipboard buttons.
            document.querySelectorAll('.copy-to-clipboard').forEach(button => button.hidden = false)

            // Rewrite the view installation script section copy to simplify it and link directly
            // to the relevant script.
            document.querySelector('#view-installation-script-source').innerHTML = (currentPlatform === 'windows') ? '<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/windows">view the source code</a>' : '<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install">view the source code</a>'
          }
        }

        function copyInstallationInstructionsToClipboardFor(platform) {
          const installationCommand = document.querySelector(`#code-${platform}`)

          const selectedCode = document.createRange()
          selectedCode.selectNode(installationCommand)
          window.getSelection().addRange(selectedCode)

          try {
            const success = document.execCommand('copy')
            if (!success) console.log('Failed to copy installation command.')
          } catch(error) {
            console.log('Copy command threw an error', error)
          }

          // Remove the selections - NOTE: Should use
          // removeRange(range) when it is supported
          window.getSelection().removeRange(selectedCode)
        }
      </script>

      <h2 id="uninstall">Uninstall</h2>

      <pre><code>site <span class='token keyword'>uninstall</span></code></pre>

      <h2 id="use">Use</h2>

      <h3 id="as-a-development-server">As a development server</h3>

      <p>You can use Site.js as a local development server <strong>with locally-trusted TLS certificates</strong> (no certificate warnings) on Linux, macOS, and Windows.</p>

      <p>To start serving the current folder at <a href="https://localhost:">https://localhost:</a></p>

      <pre><code>site</code></pre>

      <h3 id="as-a-local-proxy-server">As a proxy server</h3>

      <p>Say you’re running <a href="https://gohugo.io/">Hugo</a> locally at its default location (<a href="http://localhost:1313">http://localhost:1313</a>) and you want to test it via TLS:</p>

      <pre><code>site <span class="token keyword">:</span><span class="token number">1313</span></code></pre>

      <p>Now you can view it at <a href="https://localhost">https://localhost</a> and even your live reload will work as Site.js in proxy mode also proxies WebSockets.</p>

      <h3 id="as-a-local-development-server-with-live-sync-of-changes-to-your-production-server">As a local development server with live sync of changes to your production server</h3>

      <pre><code>site <span class="token keyword">--sync-to</span>=<span class="token string">my-demo.site</span></code></pre>

      <p>Any changes in your <em>current folder</em> will be synced via rsync over ssh to <em>your-account</em>@my-demo.site:/home/<em>your-account</em>/_current-folder-name. You can customise all of those details by providing a fully-formed rsync remote connection string for the <code>--sync-to</code> option.</p>

      <h3 id="as-a-staging-server">As a testing server</h3>

      <p>To give others access to your server without running as a deployment server (daemon):</p>

      <pre><code>site <span class="token keyword">@hostname</span></code></pre>

      <p>Similarly, can also test with proxy servers. For example, if you want to test your Hugo site from your phone, you can expose the local port at your hostname:</p>

      <pre><code>site <span class="token keyword">:</span><span class="token number">1313</span> <span class="token keyword">@hostname</span></code></pre>

      <p>Then use, for example, <a href="https://ngrok.com/">ngrok</a> (Pro+) to point a custom domain name to your temporary staging server. Make sure you set your <code>hostname</code> file (e.g., in <em>/etc/hostname</em> or via <code>hostnamectl set-hostname &lt;hostname&gt;</code> or the equivalent for your platform) to match your domain name. The first time you hit your server via your hostname it will take a little longer to load as your <a href='https://letsencrypt.org/'>Let’s Encrypt</a> certificates are being automatically provisioned by <a href='https://source.ind.ie/hypha/tools/acme-tls'>ACME TLS</a>.</p>

      <h3 id="as-a-production-server">As a production server</h3>

      <pre><code>site <span class="token keyword">enable</span></code></pre>

      <p>Once your server is running, it will survive crashes and server restarts and you can use the following commands:</p>

      <ul>
      <li><code>site status</code>: display the server status.</li>
      <li><code>site logs</code>: display the server logs.</li>
      <li><code>site disable</code>: stop the server and remove it from startup items.</li>
      </ul>

      <h2 id="dynamic">Dynamic sites</h2>

      <p>Easily add dynamic functionality to your static site or create a fully-dynamic site. Get started with PHP-like simplicity in JavaScript using simple DotJS (.js) files:</p>

      <pre><code>mkdir <span class="token keyword">-p</span> <span class="token string">count</span>/.dynamic</code>
<code>echo '<code class='language-js'>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>r<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span></code>' <span class='token keyword'>></span> count/.dynamic/<span class='token string'>index.js</span></code>
<code>site <span class="token string">count</span></code></pre>

      <p>Hit <a href='https://localhost'>https://localhost</a> and refresh to see the counter update.</p>

      <p>Congratulations, you just made your first fully-dynamic and secure DotJS site! (Seriously.)</p>

      <p>Here’s a slightly more verbose version of <code>index.js</code> that’s easier to understand:</p>

      <pre><code class='language-js'><span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  response
    <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;You’ve visited </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>counter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> time</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">'s'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

      <p>If this reminds you of a route in <a href='https://expressjs.com'>Express</a>, it’s because that’s exactly what it is.</p>

      <p>The only difference is that you don’t have to write any other code or worry about anything else including installing Node.js, provisioning TLS certificates, ensuring your site automatically restarts on reboots, etc.</p>

      <p>In addition to static routes and dynamic HTTPS routes, you can also specify WebSocket (WSS) routes in DotJS. You can also mix them as you please.</p>

      <p>For example, to create <a href='https://source.ind.ie/site.js/app/tree/master/examples/wss-basic-chat'>a very basic chat app</a>:</p>

      <pre><code>mkdir <span class="token keyword">-p</span> <span class="token string">basic-chat</span>/.dynamic/.wss</code>
<code>cat &lt;&lt; <span class="token keyword">EOF</span> > basic-chat/.dynamic/.wss/<span class="token string">chat.js</span></code>
<code class='language-js'>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">webSocket<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  webSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWss</span><span class="token punctuation">(</span><span class="token string">'/chat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">client</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">EOF</span></code>
<code>site <span class="token string">basic-chat</span></code></pre>

      <p>To test it, open up two web browser windows and enter the following into the web developer (JavaScript) console on both of them:</p>

<pre><code class='language-js'><span class="token keyword">const</span> webSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://localhost/chat'</span><span class="token punctuation">)</span>
webSocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> console<span class="token punctuation">.</span><span class="token function">log</span>
webSocket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span></code></pre>

      <p>To test <a href='https://source.ind.ie/site.js/app/tree/master/examples/wss-basic-chat'>this example</a> with a web interface, do the following and then visit <a href='https://localhost'>https://localhost</a></p>

      <pre><code>git <span class='token keyword'>clone</span> <span class='token string'>https://source.ind.ie/site.js/app</span></code>
<code>cd <span class='token string'>app</span></code>
<code>bin/site.js <span class='token string'>example/wss-basic-chat</span></code></pre>

      <p>The WebSocket functionality is from <a href='https://github.com/HenningM/express-ws/pull/122'>a slightly modified version</a> of <a href='https://github.com/HenningM/express-ws'>express-ws</a> (which in turn uses <a href=''>ws</a>). Both of those links have more usage details.</p>

      <p>For full details, see the <a href='https://source.ind.ie/site.js/app/blob/master/README.md#dynamic-sites'>Dynamic Sites documentation</a> and view the <a href='https://source.ind.ie/site.js/app/tree/master/examples'>examples</a>.</p>

      <h2 id="extend">Use as a module</h2>

      <pre><code>npm <span class='token keyword'>i</span> <span class='token string'>@ind.ie/site.js</span></code></pre>

      <p>You can use Site.js as a module in your Node.js projects. See the <a href="https://source.ind.ie/site.js/app#api">API documentation</a> for details.</p>

      <h2 id="learn-more">Learn more</h2>

      <pre><code>site <span class='token keyword'>help</span></code></pre>

      <p><a href="https://source.ind.ie/site.js/app/#sitejs">See the docs</a> for full details, like using <a href="https://source.ind.ie/site.js/app#custom-error-pages">custom error pages</a> and <a href="https://source.ind.ie/site.js/app#native-cascading-archives-support">cascading archives</a> and <a href="https://source.ind.ie/site.js/app#native-404-302-support">the 404→302 technique</a> for an evergreen web.</p>

      <h2>Site.js in production</h2>

      <p>The following sites run on Site.js:</p>

      <ul>
        <li><a href='https://small-tech.org'>Small Technology Foundation</a></li>
        <li><a href='https://better.fyi'>Better Blocker</a></li>
        <li><a href='https://laurakalbag.com'>Laura’s site</a></li>
        <li><a href='https://ar.al'>Aral’s site</a></li>
      </ul>

      <h2 id="about">About</h2>

      <p>Made with <img class='emoji inline' src='images/emoji/0040_1f496.svg' alt='love'> by <a href='https://small-tech.org'>Small Technology Foundation</a> (previously, <a href='https://ind.ie'>Ind.ie</a>).</p>

      <p>We are a tiny not-for-profit based in Ireland that makes tools for people like you – not for startups, enterprises, or governments – and is funded by people like you. <strong>If you like our work and want to help us exist, please <a href="https://small-tech.org/fund-us/">fund us</a>.</strong></p>

      <p>Site.js is <a href="https://small-tech.org/about#small-technology">Small Technology</a> and a stepping stone for <a href="https://small-tech.org/research-and-development">Tincan</a>.</p>

      <img id='logo' src='images/site-js-logo.svg' alt='Site.js logo: a tin can with a plant sprouting from it with two leaves'>

      <p class='copyright'><small>Copyright ⓒ 2019, <a href='https://small-tech.org'>Small Technology Foundation</a>. All content on this site is released under <a href='https://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike</a>. Site.js is licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.en.html'>AGPLv3 or later</a>.</small></p>
    </div>
  </main>

  <!-- Start: scripts -->
  <script src='js/perfect-scrollbar.js'></script>
  <script src='node_modules/typed.js/lib/typed.js'></script>
  <script src='js/terminal-presentation.js'></script>
  <script src='js/browser-presentation.js'></script>
  <script src='js/site-js-terminal-presentation.js'></script>
  <!-- End: scripts -->
</body>
</html>
