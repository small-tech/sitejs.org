

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site.js</title>
  <style>

    /*
      @import url('https://rsms.me/inter/inter.css?v=3.5');
      */
      html { font-family: 'Inter', sans-serif; }

      @supports (font-variation-settings: normal) {
        html { font-family: 'Inter var', sans-serif; }
      }

    /* Reset */
      html {
        box-sizing: border-box;
        font-size: 16px;
      }

      *, *:before, *:after {
        box-sizing: inherit;
      }

      body, h1, h2, h3, h4, h5, h6, p, ol, ul {
        margin: 0;
        padding: 0;
        font-weight: normal;
      }

      ol, ul {
        list-style: none;
      }

      img {
        max-width: 100%;
        height: auto;
      }
/* ----- */


    html {
      background-color:#151D1F;
      margin: 0;
      padding: 0;
/*
        background: url(mountains.jpg) no-repeat center center fixed;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
*/
      }

    body {
      margin-top: 0;
      position: relative;
      width: 100%;
      margin-left: auto;
      margin-right: auto;
    }

    header {
      color: white;
      max-width: 920px;
      margin-left: auto;
      margin-right: auto;
    }

    /*
    header:after {
      content: "";
      display: block;
      height: 0;
      width: 0;
      background-color: red;
      padding-bottom: calc(1695/2778 * 100%);
    }
*/

    main {
      padding: 1vw;
    }

    nav {
      position: absolute;
      top: 2rem;
      right: 3rem;
      font-size: 1.25em;
    }

    nav > ul {
      list-style: none;
    }

    nav li {
      color: #4D7072;
      display: inline;
      padding-right: 1em;
    }

    nav li:last-of-type {
      padding-right: 0;
    }

    #presentation {
    }

    .terminal {
      height: 12em;
      background-color: black;
      padding: 1em;
      opacity: 0.9;
      overflow-y: scroll;
    }

    #terminal-presentation, #second-terminal-presentation {
      position: relative;
      background-color: red;
      margin-left: 3rem;
      margin-right: 3rem;
      margin-bottom: 1rem;
    }

    .next-button {
      position: absolute;
      bottom: 1em;
      right: 1em;
    }

    pre, code {
      font-family: "Fira Code", monospace;
      background-color: black;
      color: white;
    }

    pre {
      white-space: pre-wrap;       /* css-3 */
      white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
      white-space: -pre-wrap;      /* Opera 4-6 */
      white-space: -o-pre-wrap;    /* Opera 7 */
      word-wrap: break-word;       /* Internet Explorer 5.5+ */

    }

    h1 {
      color: #1D2C2E;
      font-size: 96px;
      text-align: center;
      font-weight: 200;
      padding-top: 0.5em;
      margin-bottom: 0.25em;
    }

    h1 > strong {
      font-weight: 400;
    }

    h2 {
      font-size: 58px;
    }

    header > p {
      margin-left: 3rem;
      margin-right: 3rem;
      margin-bottom: 1em;
      font-size: 1.75em;
    }

    main {
      width: 100%;
      background-color: white;
    }

    .mainer {
      background-color: white;
      max-width: 920px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 3rem;
      padding-right: 3rem;
    }

    .mainer > p {
      font-size: 18px;
    }

    .background {
      position: fixed;
      z-index: -1;
    }

    @media (max-width: 460px) {
      #terminalPresentation {
        margin-left: 1rem;
        margin-right: 1rem;
        font-size: 0.9em;
      }

      .mainer {
        padding-left: 1rem;
        padding-right: 1rem;
      }

      header > p {
        margin-left: 1rem;
        margin-right: 1rem;
        font-size: 1.5em;
      }
    }

    li.selected {
      color: #151D1F;
    }

    @media (max-width: 920px) {
      body {
        width: 100%;
      }
    }

  </style>
  </head>
<body>
  <div class='background'><img src='mountains.jpg' width='100%' height='100%'></div>
  <header>
      <h1><strong>Site</strong>.js</h1>
      <nav><ul>
      <li class='selected'>Home</li>
      <li>News</li>
      <li>Fund</li>
    </ul></nav>

    <!-- Terminal presentation -->
    <div id='presentation'>
      <div id='terminal-presentation'></div>
      <div id='second-terminal-presentation'></div>
    </div>

    <p><strong>Develop, test, and deploy</strong> your <strong>secure static</strong> or <strong>dynamic personal</strong> web site with <strong>zero configuration.</strong></p>
  </header>
<main>
  <div class='mainer'>
    <h2 id="install">Install</h2>

    <p>Copy and paste the following command into your Terminal. <strong>Before you pipe any script into your computer, always <a href="/web-server/install.sh">view the source code</a> and make sure you understand what it does.</strong></p>

    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">wget -qO- https://ind.ie/web-server/install.sh | bash</code></pre></div>
  </div>
</main>

<script src="node_modules/typed.js/lib/typed.js"></script>

<script>

  class TerminalPresentation {
    constructor (containerId, originalSteps, onComplete = null, onStepComplete = null) {
      console.log(`Creating terminal presentation in element with id ${containerId}.`)

      this.onStepComplete = onStepComplete
      this.onComplete = onComplete

      // The way Typed.js works, if you want to add to the text area instead of having it
      // replaced, the string that follows the current string must start with the current
      // string. Since we want to emulate a Terminal window where text is always appended,
      // this means that each string has to include the cumulative aggregate of all
      // previous strings. Since we don’t want the person to do this, we accept an array
      // of steps, each containing the lines to be show in the step and calculate and prefix
      // the cumulative text to each entry here.
      let cumulative = ''
      const steps = originalSteps.map(lines => lines.join('\n') + '\n').map ((step, index, theArray) => {
        if (index > 0) {
          const lastStep = theArray[index-1]
          const lastStepWithoutTimingDirectives = lastStep.replace(/\^\d+/g, '')
          cumulative += lastStepWithoutTimingDirectives
          return cumulative + step
        } else {
          // Don’t massage the first entry.
          return step
        }
      })

      const initialiseInterface = () => {
        const container = document.getElementById(containerId)

        console.log('container is', container)

        // Ensure the container is showing.
        container.style.display = 'block'

        // We are going to position the presentation controls relative to the
        // container’s bounds.
        container.style.position = 'relative'

        const terminal = document.createElement('div')
        terminal.className = 'terminal'
        const _pre = document.createElement('pre')
        const _code = document.createElement('code')
        _code.className = `terminal-code-${containerId}`
        const nextButton = document.createElement('button')
        nextButton.className = 'next-button'
        nextButton.appendChild(document.createTextNode('Next'))
        nextButton.disabled = true
        _pre.appendChild(_code)
        terminal.appendChild(_pre)
        container.appendChild(terminal)
        container.appendChild(nextButton)

        this.nextButton = nextButton

        // Always keep the console at the end of the output.
        let currentStep = -1, scrollToBottomInterval
        const terminalScrollHandler = () => {
          terminal.scrollTop = terminal.scrollHeight
        }

        // Create the typing animation and start the first frame.
        var typed = new Typed(`.${_code.className}`, {
          strings: steps,
          backDelay: 0,
          preStringTyped: () => {
            // Gets called once, at the start of the animation.
            scrollToBottomInterval = setInterval(terminalScrollHandler, 500)
          },
          onStringTyped: (arrayPosition) => {
            console.log('On string typed:', arrayPosition)
            if (arrayPosition !== currentStep) {
              console.log(`Array position ${arrayPosition} !== current step ${currentStep}`)
              // A new step has ended. Make sure we’re scrolled to the
              // bottom. Toggle the typing off and stop forcing the
              // terminal to the bottom so that the person can scroll back
              // if they want to review any of the steps.
              clearInterval(scrollToBottomInterval)
              terminal.scrollTop = terminal.scrollHeight

              // Is the presentation over?
              if (arrayPosition === steps.length - 1) {
                nextButton.hidden = true
                return
              }

              typed.stop()

            }
            currentStep = arrayPosition
          },
          onStart: () => {
            console.log('Start')
            nextButton.disabled = true
            scrollToBottomInterval = setInterval(terminalScrollHandler, 500)
          },
          onStop: () => {
            console.log('Stop', currentStep)
            if (typeof this.onStepComplete === 'function') {
              this.onStepComplete(currentStep+1)
            }
            nextButton.disabled = false
          },
          onComplete: () => {
            console.log('Complete!')
            if (typeof this.onComplete === 'function') {
              this.onComplete()
            }
          }
        })

        // When the next button is clicked, toggle the typing animation (off).
        nextButton.addEventListener('click', (event) => {
          typed.start()
        })
      }

      // Make sure we initialise the interface regardless of whether we are
      // created before page load or after.
      if (document.readyState === 'complete') {
        initialiseInterface()
      } else {
        window.addEventListener('load', initialiseInterface)
      }
    }

    showControls () {
      this.nextButton.hidden = false
    }

    hideControls () {
      this.nextButton.hidden = true
    }
  }

  //
  // The terminal presentation script.
  //

  const NEW_LINE = '\n'
  const EMPTY_LINE = '\n\n'
  const WAIT_ONE_SEC = '^1000'
  const WAIT_QUARTER_SEC = '^250'
  const VERSION = '1.0.0'
  const NBSP = '&nbsp;'

  function comment (text) { return `<span style="color: #ccc"># ${text}</span>` }
  function inGreen (text) { return `<span style="color: #849900">${text}</span>` }
  function inCyan (text) { return `<span style="color: #29A097">${text}</span>` }

  const firstTerminalPresentation = new TerminalPresentation('terminal-presentation', [
    [
      // Slide 0
      `⯈ ${comment('Install')}${WAIT_ONE_SEC}`,
      `⯈ wget -q0- https://sitejs.org/install | bash`,
    ],
    [
      // Slide 1
      '',
      ` 📡 Downloading Site.js v${VERSION}…${WAIT_QUARTER_SEC}`,
      ` 📦 Installing…${WAIT_QUARTER_SEC}`,
      ` 🎉 Done!`,
      '',
      `⯈ ${WAIT_ONE_SEC}${comment('Run local development server')} ${WAIT_ONE_SEC}`,
      `⯈ site`
    ],
    [
      // Slide 2
      '',
      ` 💖 Site.js v${VERSION} (running on Node.js v10.15.3)`,
      '',
      ' 🚧 [Site.js] Using locally-trusted certificates.',
      ' 📜 [Nodecert] Local development TLS certificate exists.',
      '',
      ` 🎉 Serving ${inCyan('.')} on ${inGreen('https://localhost')}`,
      '',
      NBSP
    ],
    [
      // Slide 3: Exit local server and show command to start a global server.
      '^C',
      ' 💃 Preparing to exit gracefully, please wait…',
      '',
      ' 💖 Goodbye!',
      '',
      `⯈ ${WAIT_ONE_SEC}${comment('Run a globally-reachable staging server')}`,
      '⯈ site global '
    ],
    [
      // Slide 4: The global server output.
      '',
      ` 💖 Site.js v${VERSION} (running on Node.js v10.15.3)`,
      '',
      ' 🌍 [Site.js] Using globally-trusted certificates.',
      ' 👉 [Site.js] HTTP → HTTPS redirection active.',
      '',
      ` 🎉 Serving ${inCyan('.')} on ${inGreen('https://dev.ar.al')}`,
      '',
      NBSP
    ],
    [
      // Slide 5: Break out of global server.
      '^C',
      ' 💃 Preparing to exit gracefully, please wait…',
      '',
      ' 💖 Goodbye!',
      '',
      `⯈ ${WAIT_ONE_SEC}${comment('Install and run site as startup daemon')}`,
      '⯈ site enable '
    ],
    [
      // Slide 6: Output of running as startup daemon.
      '',
      ` 💖 Site.js v${VERSION} (running on Node.js v10.15.3)`,
      '',
      ` 😈 Launched as daemon on ${inGreen('https://aral.hypha.dev')} serving ${inCyan('.')}`,
      '',
      ' 😈 Installed for auto-launch at startup.',
      '',
      ` 😁👍 You’re all set!`,
      '',
      '⯈ '
    ]
  ], null, (slide) => {
    //
    // Split the terminals and create a second terminal animation.
    //
    if (slide === 4) {
      //
      // This sequence runs after slide 4.
      //
      firstTerminalPresentation.hideControls()

      new TerminalPresentation('second-terminal-presentation', [
        [
          // Slide 1.
          `⯈ ${comment('Launch ngrok to expose local server globally')}${WAIT_ONE_SEC}`,
          `⯈ ngrok start --all`,
        ],
        [
          // An empty slide to ensure we pause on the first slide.
          ''
        ]
      ], () => {
        const ngrokInterfaceMock = [
          `${inCyan('ngrok')} by ${inCyan('@inconshreveable')}`,
          '',
          `${inGreen('Status      online')}`,
          'Account     Pro (Plan: Ind.ie)',
          'Region      Europe (eu)',
          'Forwarding  dev.ar.al -> localhost'
        ].join('\n')

        const secondPresentationTerminalCode = document.querySelector('#second-terminal-presentation .terminal-code-second-terminal-presentation')

        secondPresentationTerminalCode.innerHTML = ngrokInterfaceMock

        // Return control to the first terminal presentation.
        firstTerminalPresentation.showControls()
      })
    } else if (slide === 5) {
      //
      // This sequence runs after slide 5.
      //

      // Hide the second terminal window.
      document.querySelector('#second-terminal-presentation').style.display = 'none'
    }
  })

</script>
</body>
</html>
