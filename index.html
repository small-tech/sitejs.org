<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site.js</title>
  <!-- Start: styles -->
  <link rel='stylesheet' href='css/perfect-scrollbar.css'>
  <link rel='stylesheet' href='css/facade.css'>
  <link rel='stylesheet' href='css/prism.css'>
  <link rel='stylesheet' href='css/index.css'>
  <!-- End: styles -->
</head>
<body>
  <header>
    <div class='content'>
      <!-- Title -->
      <h1><strong>Site</strong>.js</h1>

      <!-- Navigation -->
      <nav>
        <ul>
          <li class='selected'>Home</li>
          <li><a href='https://github.com/small-tech/site.js'>Source</a></li>
          <li><a href='https://github.com/small-tech/site.js/blob/master/README.md'>Docs</a></li>
          <li><a href='https://github.com/small-tech/site.js/issues'>Issues</a></li>
          <li><a href='https://github.com/small-tech/site.js/blob/master/CHANGELOG.md'>News</a></li>
          <li><a href='https://small-tech.org/fund-us'>Fund Us!</a></li>
        </ul>
      </nav>

      <!-- Browser presentation -->
      <div id='browser' class='shadow' aria-hidden='true'></div>

      <!-- Terminal presentation -->
      <div id='presentation' aria-hidden='true'>
        <div id='terminal-presentation' class='unfocused shadow'></div>
        <div id='second-terminal-presentation' class='shadow'></div>
        <button id='next-button' class='next-button' disabled>Next</button>
      </div>

      <!-- Short description -->
      <p id='summary'><strong>Develop, test, and deploy</strong> your <strong>secure static</strong> or <strong>dynamic personal</strong> web site with <strong>zero configuration.</strong></p>
    </div>
  </header>

  <main>
    <div class='content'>
      <h2 id="install">Install</h2>

      <p>Copy and paste the following command into <span id='terminal-copy'>your terminal</span>. <strong>Before you pipe any script into your computer, always <span id='view-installation-script-source'>view the source code (<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install">Linux and macOS</a>, <a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install.txt">Windows</a>)</span> and make sure you understand what it does.</strong></p>

      <section id='install-linux' class='installation-instructions'>
        <h3>Linux – x64 and ARM<span id='title-details-linux'></span></h3>

        <p><em>(Built on <span class='humanReadableBinaryVersion'></span>. Includes Node.js <span class='nodeVersion'></span> & Hugo <span class='hugoVersion'></span>. <a class='sourceUrl'>View Source</a>.)</em></p>

        <pre><code id='code-linux'>wget -qO- <span class='token string'>https://sitejs.org/install</span> <span class='token keyword'>| bash</span></code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("linux")'>Copy</button></pre>
      </section>

      <section id='install-mac' class='installation-instructions'>
        <h3>macOS <span id='title-details-mac'></span></h3>

        <p><em>(Built on <span class='humanReadableBinaryVersion'></span>. Includes Node.js <span class='nodeVersion'></span>. <a class='sourceUrl'>View Source</a>.)</em></p>

        <pre><code id='code-mac'>curl -s <span class='token string'>https://sitejs.org/install</span> <span class='token keyword'>| bash</span></code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("mac")'>Copy</button></pre>
      </section>

      <section id='install-windows' class='installation-instructions'>
        <h3>Windows 10 <span id='title-details-windows'></span></h3>

        <p><em>(Built on <span class='humanReadableBinaryVersion'></span>. Includes Node.js <span class='nodeVersion'></span>. <a class='sourceUrl'>View Source</a>.)</em></p>

        <pre><code id='code-windows'>iex(iwr -UseBasicParsing <span class='token string'>https://sitejs.org/install.txt</span>).Content</code><button hidden class='copy-to-clipboard' onClick='copyInstallationInstructionsToClipboardFor("windows")'>Copy</button></pre>
      </section>

      <p id='links-to-instructions-for-other-platforms' hidden>
        <strong>Instructions for other platforms:</strong>
        <span id='link-linux'><a onClick='displayInstallationInstructionsFor("linux")'>Linux</a> | </span>
        <span id='link-mac'><a onClick='displayInstallationInstructionsFor("mac")'>macOS</a><span id='pipe-before-windows'> | </span></span>
        <a id='link-windows' onClick='displayInstallationInstructionsFor("windows")'>Windows</a>
      </p>

      <section id='advanced-customisation'>
        <h4>Advanced: customise installation</h4>
        <form name='advanced'>
          <fieldset id='download-method'>
            <legend>Download method</legend>
            <input type='radio' name='download-mechanism' value='wget' checked onClick='customiseDownloadMethod("wget -qO-")'>wget</input>
            <input type='radio' name='download-mechanism' value='curl' onClick='customiseDownloadMethod("curl -s")'>curl</input>
          </fieldset>
          <fieldset id='version'>
            <legend>Version</legend>
            <input type='radio' name='version' value='release' checked onClick='customiseVersion("")'>release</input>
            <input type='radio' name='version' value='beta' onClick='customiseVersion(" -s -- beta")'>beta</input>
            <input type='radio' name='version' value='alpha' onClick='customiseVersion(" -s -- alpha")'>alpha</input>
          </fieldset>
          <strong></strong>
        </fieldset>
        </form>
        </section>

      <h2 id="update">Update</h2>

      <pre><code>site <span class='token keyword'>update</span></code></pre>

      <h2 id="uninstall">Uninstall</h2>

      <pre><code>site <span class='token keyword'>uninstall</span></code></pre>

      <h2 id="use">Use</h2>

      <h3 id="as-a-development-server">As a development server</h3>

      <p>You can use Site.js as a local development server <strong>with locally-trusted TLS certificates</strong> (no certificate warnings) on Linux, macOS, and Windows.</p>

      <p>To start serving the current folder at <a href="https://localhost:">https://localhost:</a></p>

      <pre><code>site</code></pre>

      <h3 id="as-a-local-proxy-server">As a proxy server</h3>

      <p>Say you’re running <a href="https://gohugo.io/">Hugo</a> locally at its default location (<a href="http://localhost:1313">http://localhost:1313</a>) and you want to test it via TLS:</p>

      <pre><code>site <span class="token keyword">:</span><span class="token number">1313</span></code></pre>

      <p>Now you can view it at <a href="https://localhost">https://localhost</a> and even your live reload will work as Site.js in proxy mode also proxies WebSockets.</p>

      <h3 id="as-a-local-development-server-with-live-sync-of-changes-to-your-production-server">As a local development server with live sync of changes to your production server</h3>

      <pre><code>site <span class="token keyword">--sync-to</span>=<span class="token string">my-demo.site</span></code></pre>

      <p>Any changes in your <em>current folder</em> will be synced via rsync over ssh to <em>your-account</em>@my-demo.site:/home/<em>your-account</em>/_current-folder-name. You can customise all of those details by providing a fully-formed rsync remote connection string for the <code>--sync-to</code> option.</p>

      <p><strong>The sync feature is not available on Windows</strong> as a viable free and open <a href='https://en.wikipedia.org/wiki/Rsync'>rsync</a> implementation does not exist for that platform.</p>

      <h3 id="as-a-staging-server">As a testing server</h3>

      <p>To give others access to your server without running as a deployment server (daemon):</p>

      <pre><code>site <span class="windows-only" hidden>"</span><span class="token keyword">@hostname</span><span class="windows-only" hidden>"</span></code></pre>

      <p>Similarly, can also test with proxy servers. For example, if you want to test your Hugo site from your phone, you can expose the local port at your hostname:</p>

      <pre><code>site <span class="token keyword">:</span><span class="token number">1313</span> <span class="windows-only" hidden>"</span><span class="token keyword">@hostname</span><span class="windows-only" hidden>"</span></code></pre>

      <p>Then use, for example, <a href="https://ngrok.com/">ngrok</a> (Pro+) to point a custom domain name to your temporary staging server. Make sure you set your <code>hostname</code> file (e.g., in <em>/etc/hostname</em> or via <code>hostnamectl set-hostname &lt;hostname&gt;</code> or the equivalent for your platform) to match your domain name. The first time you hit your server via your hostname it will take a little longer to load as your <a href='https://letsencrypt.org/'>Let’s Encrypt</a> certificates are being automatically provisioned by <a href='https://source.ind.ie/hypha/tools/acme-tls'>ACME TLS</a>.</p>

      <p class='windows-only'>Note that on Windows, <a href='https://source.ind.ie/site.js/app/blob/master/README.md#windows-10-notes'>your full computer name</a> is used as your hostname and you must put quotation marks around <code>@hostname</code> and <code>@localhost</code>, which you do not need to do on other platforms.</p>

      <h3 id="as-a-production-server">As a production server</h3>

      <pre><code>site <span class="token keyword">enable</span></code></pre>

      <p><strong>The production server feature requires Linux with <a href='https://www.freedesktop.org/wiki/Software/systemd/'>systemd</a>.</strong> We use Site.js in production at <a href='https://small-tech.org'>Small Technology Foundation</a> on Ubuntu 18.04 LTS.</p>

      <p>Once your server is running, it will survive crashes and server restarts and you can use the following commands:</p>

      <ul>
      <li><code>site status</code>: display the server status.</li>
      <li><code>site logs</code>: display the server logs.</li>
      <li><code>site disable</code>: stop the server and remove it from startup items.</li>
      </ul>

      <h2 id="dynamic">Dynamic sites</h2>

      <p>Easily add dynamic functionality to your static site or create a fully-dynamic site. Get started with PHP-like simplicity in JavaScript using simple DotJS (.js) files:</p>

      <pre><code>mkdir <span class="token keyword">-p</span> <span class="token string">count</span>/.dynamic</code>
<code>echo '<code class='language-js'>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>r<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span></code>' <span class='token keyword'>></span> count/.dynamic/<span class='token string'>index.js</span></code>
<code>site <span class="token string">count</span></code></pre>

      <p>Hit <a href='https://localhost'>https://localhost</a> and refresh to see the counter update.</p>

      <p>Congratulations, you just made your first fully-dynamic and secure DotJS site! (Seriously.)</p>

      <p>Here’s a slightly more verbose version of <code>index.js</code> that’s easier to understand:</p>

      <pre><code class='language-js'><span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  response
    <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;You’ve visited </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>counter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> time</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">'s'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

      <p>If this reminds you of a route in <a href='https://expressjs.com'>Express</a>, it’s because that’s exactly what it is.</p>

      <p>The only difference is that you don’t have to write any other code or worry about anything else including installing Node.js, provisioning TLS certificates, ensuring your site automatically restarts on reboots, etc.</p>

      <p>In addition to static routes and dynamic HTTPS routes, you can also specify WebSocket (WSS) routes in DotJS. You can also mix them as you please.</p>

      <p>For example, to create a very basic chat app:</p>

      <pre><code>mkdir <span class="token keyword">-p</span> <span class="token string">basic-chat</span>/.dynamic/.wss</code>
<code>cat &lt;&lt; <span class="token keyword">EOF</span> > basic-chat/.dynamic/.wss/<span class="token string">chat.js</span></code>
<code class='language-js'>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">room</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>setRoom<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>broadcast<span class="token punctuation">(</span>client<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">EOF</span></code>
<code>site <span class="token string">basic-chat</span></code></pre>

      <p>To test it, open up two web browser windows and enter the following into the web developer (JavaScript) console on both of them:</p>

<pre><code class='language-js'>socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://localhost/chat'</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span></code></pre>

      <p>The broadcast method, by default, has rudimentary client filtering and only sends a message to clients other than the one that originally sent the message and only to clients connected to the same route (or “room”). For a fully-documented version of the above example, see <a href='https://source.ind.ie/site.js/app/blob/master/examples/wss-basic-chat/.dynamic/.wss/chat.js'>the source code for the Basic Chat example.</a></p>

      <p>To run that example with a basic web interface, do the following and then visit <a href='https://localhost'>https://localhost</a></p>

      <pre><code>git <span class='token keyword'>clone</span> <span class='token string'>https://source.ind.ie/site.js/app</span></code>
<code>cd <span class='token string'>app</span></code>
<code>site <span class='token string'>examples/wss-basic-chat</span></code></pre>

      <p>The WebSocket functionality is from <a href='https://github.com/aral/express-ws'>our fork of express-ws</a> (which in turn uses <a href='https://github.com/websockets/ws'>ws</a>). Both of those links have more usage details.</p>

      <p>For full details, see the <a href='https://source.ind.ie/site.js/app/blob/master/README.md#dynamic-sites'>Dynamic Sites documentation</a> and view the <a href='https://source.ind.ie/site.js/app/tree/master/examples'>examples</a>.</p>

      <h2 id="static">Static Site Generation</h2>

      <p>As of version 12.11.0, Site.js includes the <a href='https://gohugo.io'>Hugo static site generator</a>.</p>

      <p>To create a new Hugo site and start serving it:</p>

      <pre><code>mkdir <span class="token string">my-site</span></code> <code>cd <span class="token string">my-site</span></code> <code>site <span class="token keyword">hugo</span> new site <span class="token string">.hugo</span></code> <code>echo <span class="token string">"&lt;body&gt;&lt;h1&gt;Hello, world!&lt;h1&gt;&lt;body&gt;"</span> > <span class="token string">.hugo/layouts/index.html</span></code> <code>site</code></pre>

      <p>Note: During development, this feature uses Site.js’s live reload instead of Hugo’s. Your web page must have at least a <code>&lt;body&gt;</code> tag for it to work.</p>

      <h3>How it works</h3>

      <p>If Site.js finds a folder called <em>.hugo</em> in your site’s root, it will build it using its integrated Hugo instance (you don’t need to install Hugo separately) and place the generated files into a folder called <em>.generated</em> in your site’s root. It will also automatically serve these files.</p>

      <p>You can pass any command you would normally pass to Hugo using Site.js’s integrated Hugo instance:<pre><code>site <span class="token keyword">hugo</span> <span class="token string">[any valid Hugo command]</any></span></code></pre></p>

      <p>Please see <a href='https://gohugo.io/documentation/'>the Hugo documentation</a> for detailed information on how Hugo works.</p>

      <h3>Mounting Hugo sites</h3>

      <p>Site.js will automatically mount files in the <em>.hugo</em> directory at your site’s root.</p>

      <p>If you want the generated Hugo site to be mounted at a different path, include the path structure you want in the name of the hugo folder, separating paths using two dashes. For example:</p>

      <table class='paths-table'>
        <th>Folder name</th>
        <th>Mount path</th>
        <tr>
          <td>.hugo</td>
          <td>/</td>
        </tr>
        <tr>
          <td>.hugo--docs</td>
          <td>/docs/</td>
        </tr>
        <tr>
          <td>.hugo--second-level--blog</td>
          <td>/second-level/blog</td>
        </tr>
      </table>

      <p>You can include any number of Hugo sites in your site and mount them at different paths and the results will be weaved together into the <em>.generated</em> folder. We call this feature… <em>ahem</em>… Hugo Weaving (we’ll show ourselves out).</p>

      <p>All regular Site.js functionality is still available when using Hugo generation. So you can, for example, have your blog statically-generated using Hugo and extend it using locally-hosted dynamic comments.</p>

      <h2 id="extend">Use as a module</h2>

      <pre><code>npm <span class='token keyword'>i</span> <span class='token string'>@small-tech/site.js</span></code></pre>

      <p>You can use Site.js as a module in your Node.js projects. See the <a href="https://source.ind.ie/site.js/app#api">API documentation</a> for details.</p>

      <h2 id="learn-more">Learn more</h2>

      <pre><code>site <span class='token keyword'>help</span></code></pre>

      <p><a href="https://source.ind.ie/site.js/app/#sitejs">See the docs</a> for full details, like using <a href="https://source.ind.ie/site.js/app#custom-error-pages">custom error pages</a>, <a href="https://source.ind.ie/site.js/app#native-cascading-archives-support">cascading archives</a>, and <a href="https://source.ind.ie/site.js/app#native-404-302-support">the 404→302 technique</a> for an evergreen web.</p>

      <h2>Site.js in production</h2>

      <p>The following sites run on Site.js:</p>

      <ul>
        <li><a href='https://small-tech.org'>Small Technology Foundation</a></li>
        <li><a href='https://better.fyi'>Better Blocker</a></li>
        <li><a href='https://laurakalbag.com'>Laura’s site</a></li>
        <li><a href='https://ar.al'>Aral’s site</a></li>
      </ul>

      <h2 id="about">About</h2>

      <p>Made with <img class='emoji inline' src='images/emoji/0040_1f496.svg' alt='love'> by <a href='https://small-tech.org'>Small Technology Foundation</a> (previously, <a href='https://ind.ie'>Ind.ie</a>).</p>

      <p>We are a tiny not-for-profit based in Ireland that makes tools for people like you – not for startups, enterprises, or governments. And we’re also funded by people like you. <strong>If you like our work and want to help us exist, please <a href="https://small-tech.org/fund-us/">fund us</a>.</strong></p>

      <p>Site.js is <a href="https://small-tech.org/about#small-technology">Small Technology</a> and the foundations of <a href="https://small-tech.org/research-and-development">Tincan</a>.</p>

      <img id='logo' src='images/site-js-logo.svg' alt='Site.js logo: a tin can with a plant sprouting from it with two leaves'>

      <p class='copyright'><small>Copyright ⓒ 2019-2020, <a href='https://small-tech.org'>Small Technology Foundation</a>. All content on this site is released under <a href='https://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike</a>. Site.js is free software licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.en.html'>AGPLv3 or later</a>. The background pattern is <a href='https://leaverou.github.io/css3patterns/#cross-dots'>Cross-Dots</a> by Natali Davydova from the <a href='https://leaverou.github.io/css3patterns/'>CSS3 Patterns Gallery</a>.</small></p>
    </div>
  </main>

  <!-- Start: scripts -->
  <script src='js/perfect-scrollbar.js'></script>
  <script src='node_modules/typed.js/lib/typed.js'></script>
  <script src='node_modules/moment/min/moment.min.js'></script>
  <script src='js/terminal-presentation.js'></script>
  <script src='js/browser-presentation.js'></script>
  <script src='js/site-js-terminal-presentation.js'></script>
  <!-- End: scripts -->

  <script>
    //////////////////////////////////////////////////////////////////////
    //
    // ⚠ GENERATED CODE. Please do not change.
    //
    // These are the latest versions of the various release channels.
    // They are automatically populated by the Site.js build script
    // on deployment.
    //
    //////////////////////////////////////////////////////////////////////

    const versions = {
      alphaBinaryVersion: 00000000000000,
      alphaNodeVersion: '00.00.00',
      alphaHugoVersion: '00.00.00',
      alphaPackageVersion: '00.00.00',
      alphaSourceVersion: 'bedface',

      betaBinaryVersion: 00000000000000,
      betaNodeVersion: '00.00.00',
      betaHugoVersion: '00.00.00',
      betaPackageVersion: '00.00.00',
      betaSourceVersion: 'acecafe',

      releaseBinaryVersion: 00000000000000,
      releaseNodeVersion: '00.00.00',
      releaseHugoVersion: '00.00.00',
      releasePackageVersion: '00.00.00',
      releaseSourceVersion: 'decafAF',
    }

    //////////////////////////////////////////////////////////////////////
    // End of generated code.
    //////////////////////////////////////////////////////////////////////

    const $  = document.querySelector.bind(document)
    const $$ = document.querySelectorAll.bind(document)

    function binaryVersionToHumanReadableDateString (binaryVersion) {
      console.log(binaryVersion)
      const m = moment(binaryVersion, 'YYYYMMDDHHmmss')
      return `${m.format('MMMM Do, YYYY')} at ${m.format('HH:mm:ss')}`
    }

    // Progressively enhance the installation instructions to only show the ones for the
    // detected platform (with links to the others), if we can detect a supported platform.
    let visiblePlatform = 'linux'

    function displayVersionInformation () {

      const _ = version => versions[`${document.advanced.version.value}${version}`]

      $$('.humanReadableBinaryVersion').forEach(span =>
        span.innerHTML = binaryVersionToHumanReadableDateString(_('BinaryVersion'))
      )
      $$('.nodeVersion').forEach(span => span.innerHTML = _('NodeVersion'))
      $$('.hugoVersion').forEach(span => span.innerHTML = _('HugoVersion'))
      $$('.sourceUrl').forEach(a =>
        a.setAttribute('href', `https://source.small-tech.org/site.js/app/-/tree/${_('SourceVersion')}`)
      )
    }

    const defaultInstallationString = {
      linux: $('#code-linux').innerHTML,
      mac: $('#code-mac').innerHTML,
      windows: $('#code-windows').innerHTML
    }

    function inputWithValue(value) {
      return $(`input[value="${value}"]`)
    }
    const radioButtons = {
      wget: inputWithValue('wget'),
      curl: inputWithValue('curl'),
      release: inputWithValue('release'),
      alpha: inputWithValue('alpha'),
      beta: inputWithValue('beta')
    }

    const userAgent = navigator.userAgent.toLowerCase()
    let currentPlatform = 'unknown'
    if (userAgent.includes('linux')) { currentPlatform = 'linux' }
    if (userAgent.includes('mac os x')) { currentPlatform = 'mac' }
    if (userAgent.includes('windows')) { currentPlatform = 'windows'}

    displayInstallationInstructionsFor(currentPlatform)

    function displayInstallationInstructionsFor(currentPlatform) {
      if (currentPlatform !== 'unknown') {
        visiblePlatform = currentPlatform
        // Show the instructions for the detected platform and hide the ones for the other platforms.
        ;['linux', 'mac', 'windows'].forEach(platform => {
          $(`#install-${platform}`).hidden = !(platform === currentPlatform)
          $(`#link-${platform}`).hidden = (platform === currentPlatform)
        })

        // Cosmetic: don’t show the last separator if there’s no content after it.
        $('#pipe-before-windows').hidden = (currentPlatform === 'windows')

        // Show links to instructions for other platforms.
        $('#links-to-instructions-for-other-platforms').hidden = false

        // Show all the copy to clipboard buttons.
        $$('.copy-to-clipboard').forEach(button => button.hidden = false)

        // Rewrite the view installation script section copy to simplify it and link directly
        // to the relevant script.
        $('#view-installation-script-source').innerHTML = (currentPlatform === 'windows') ? '<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install.txt">view the source code</a>' : '<a href="https://source.ind.ie/site.js/site/blob/master/installation-scripts/install">view the source code</a>'

        // Also rewrite the terminal-related bit of the copy to specify exactly the environment that
        // we support on Windows 10.
        $('#terminal-copy').innerHTML = (currentPlatform === 'windows') ? 'a PowerShell session running under <a href="https://github.com/Microsoft/Terminal">Windows Terminal</a>' : 'your terminal'

        // Hide/display any Windows-only caveats.
        $$('.windows-only').forEach(node => node.hidden = !(currentPlatform === 'windows'))

        // Set the radio button states to match the installation instructions shown.
        setRadioButtonStates()

        // Display specific version-related information for the download.
        displayVersionInformation()

        // Disable the advanced customisation if for Windows. (At least for now, given that
        // – surprise, surprise – Windows is again problematic in that you cannot pass arguments
        // to downloaded scripts. See https://github.com/PowerShell/PowerShell/issues/8816#issuecomment-460327955)
        $('#advanced-customisation').hidden = (currentPlatform === 'windows')
      }
    }

    function copyInstallationInstructionsToClipboardFor (platform) {
      const installationCommand = $(`#code-${platform}`)

      const selectedCode = document.createRange()
      selectedCode.selectNode(installationCommand)
      window.getSelection().addRange(selectedCode)

      try {
        const success = document.execCommand('copy')
        if (!success) console.log('Failed to copy installation command.')
      } catch(error) {
        console.log('Copy command threw an error', error)
      }

      // Remove the selections - NOTE: Should use
      // removeRange(range) when it is supported
      window.getSelection().removeRange(selectedCode)
    }

    function customiseDownloadMethod (type) {
      const currentInstallationString = $(`#code-${visiblePlatform}`)
      currentInstallationString.innerHTML = currentInstallationString.innerHTML.replace(type === 'wget -qO-' ? 'curl -s' : 'wget -qO-', type)
      updateTitleState(currentInstallationString)
    }

    function customiseVersion (version) {
      const currentInstallationString = $(`#code-${visiblePlatform}`)
      currentInstallationString.innerHTML = currentInstallationString.innerHTML.replace(/(<span class="token keyword">\| bash<\/span>).*?$/, `$1${version}`)
      updateTitleState(currentInstallationString)
    }

    function updateTitleState (currentInstallationString) {
      const currentInstallationSectionTitle = $(`#title-details-${visiblePlatform}`)
      currentInstallationSectionTitle.innerHTML = currentInstallationString.innerHTML === defaultInstallationString[visiblePlatform] ? '' : ' (customised)'

      console.log('current', currentInstallationString.innerHTML)
      console.log('default', defaultInstallationString[visiblePlatform])
    }

    function setRadioButtonStates () {
      const currentInstallationString = $(`#code-${visiblePlatform}`).innerHTML
      Object.keys(radioButtons).forEach(function(radioButtonValue) {
        if (currentInstallationString.includes(radioButtonValue)) {
          radioButtons[radioButtonValue].checked = true
        }
      })
      // Special case: release.
      if (!currentInstallationString.includes('alpha') && !currentInstallationString.includes('beta')) {
        radioButtons['release'].checked = true
      }
    }
  </script>
</body>
</html>
